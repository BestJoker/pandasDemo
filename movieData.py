# coding:utf-8import pandas as pdimport numpy as npimport osPROJECT_ROOT = os.path.dirname(os.path.realpath(__file__))movie_path = os.path.join(PROJECT_ROOT,'data/movies.dat')user_path = os.path.join(PROJECT_ROOT,'data/users.dat')rating_path = os.path.join(PROJECT_ROOT,'data/ratings.dat')movie_data = pd.read_csv(movie_path,sep="::",names=['movie_id','movie_name','movie_type'],header=None,engine="python")user_date = pd.read_csv(user_path,sep="::",header=None,engine="python",names=["user_id","gender","age","occupation","zip_code"])rating_data = pd.read_csv(rating_path,sep="::",header=None,names=["user_id","movie_id","rating","timestamp"],engine='python')# print (movie_data.head())# print (user_date.head())# print (rating_data.head())movie_rating = pd.merge(movie_data,rating_data,on='movie_id')df = pd.merge(movie_rating,user_date,on='user_id')print (df.head())print (df.info())#1.平均分排名#找出平均分最高的电影series = df.groupby(by=['movie_id','movie_name']).rating.mean().sort_values(ascending=False)# print (series.head())#2.不同性别的平均分gender_rating = df.groupby(by=['movie_id','movie_name','gender']).rating.mean().unstack()# print (gender_rating.head())#不同性别争议最大的电影gender_rating['diff'] = gender_rating['F'] - gender_rating['M']gender_rating = gender_rating.sort_values(by='diff',ascending=False)# print (gender_rating.head())f = gender_rating.dropna()[:10]m = gender_rating.dropna()[-10:]diff = pd.concat([f,m])# print (diff.head())#4.评分次数最多热门的电影series = df.groupby(by=['movie_id','movie_name']).size()series = series.sort_values(ascending=False)# print (series)#5.不同年龄段争议最大的电影bins = [0,17,24,34,44,49,55,56]df['age_range'] = pd.cut(df['age'],bins,labels=['Under 18','18-24','25-34','35-44','45-49','50-55','56+'])print (df.groupby('age_range').agg({'rating':[np.mean,np.size]}))