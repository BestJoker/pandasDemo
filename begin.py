# coding:utf-8import pandas as pdimport numpy as npimport osimport openpyxlfrom datetime import datetime,date,timedelta#将每日的漏斗数据传入进来def get_total_data(df,array):    result_df = df[df['当日_分社'] == '全国'].sort_values(by='当日_时间',ascending=True).reset_index(drop=True)    result_df = result_df[array]    # print (result_df)    # print (result_df.info())    #环比增长速度＝（本期数－上期数）/上期数*100％    df1 = result_df.iloc[-1::].reset_index(drop=True)    df2 = result_df.iloc[-2:-1:].reset_index(drop=True)    df3 = df1.sub(df2,fill_value = 0).div(df2).rename(index={0:'日环比'})    #拼接日环比    result_df = pd.concat([result_df,df3])    #取出最后两列    result_df = result_df[-2::]    print (result_df)#获取分社漏斗数据def get_community_data(df,sort_str):    end_date = (date.today() + timedelta(days=-1)).strftime("%Y-%m-%d")  # 昨天日期    #获取其中去除全国的分社数据，并且找到昨天的数据,并按照当天申请数量排序    result_df = df[(df['当日_分社'] != '全国') & (df['当日_时间'].str.contains(end_date))].sort_values(by=sort_str,ascending=False).reset_index(drop=True)    print (result_df)    return result_dfdef begin():    PROJECT_ROOT = os.path.dirname(os.path.realpath(__file__))    #处理漏斗数据    funnel_path = os.path.join(PROJECT_ROOT,'data/漏斗数据.xlsx')    funnel_df = pd.read_excel(funnel_path)    print (funnel_df.info())    funel_array = ['当日_已申请','当日_全部已配置课程数','当日_已领取','累计_已申请','累计_全部已配置课程数','累计_已领取']    total_funnel_data_df = get_total_data(funnel_df,funel_array)    community_funnel_data_df = get_community_data(funnel_df,'当日_已申请')    #处理领取数据    learn_path = os.path.join(PROJECT_ROOT,'data/学习数据.xlsx')    learn_df = pd.read_excel(learn_path)    print (learn_df.head())    print (learn_df.info())    learn_array = ['当日_成功领取人数','当日_新注册并领取人数','当日_领取看课人数','累计_成功领取人数','累计_新注册并领取人数','累计_领取看课人数']    total_learn_data_df = get_total_data(learn_df,learn_array)    comunity_learn_data_df = get_community_data(learn_df,'当日_成功领取人数')begin()